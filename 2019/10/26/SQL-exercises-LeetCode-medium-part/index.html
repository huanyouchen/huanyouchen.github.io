<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="python，Java，hacker"><title>LeetCode中的sql练习题-medium难度部分 | 幻悠尘的小窝</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-118684665-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '6630ddc4c60afb15b88971c6ab1d81a8';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LeetCode中的sql练习题-medium难度部分</h1><a id="logo" href="/.">幻悠尘的小窝</a><p class="description">The quieter you become,the more you are able to hear.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tags"> 标签</i></a><a href="/projects/"><i class="fa fa-github"> 作品</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/message-board/"><i class="fa fa-comments"> 留言</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">LeetCode中的sql练习题-medium难度部分</h1><div class="post-content"><p>本文包含LeetCode中medium难度部分的SQL练习题的解题思路和通过代码，关于题目描述可以查看<a href="https://leetcode.com/problemset/database/" target="_blank" rel="noopener">leetcode原网站</a>，或者<a href="https://leetcode-cn.com/problemset/database/?difficulty=%E4%B8%AD%E7%AD%89" target="_blank" rel="noopener">leetcode中文网站</a></p>
<p>关于带锁的部分练习，由于博主没有开会员，所以没有在LeetCode网站上测试过，参考了别的博客写的。</p>
<p>Easy部分的练习题：<a href="https://huanyouchen.github.io/2019/09/11/SQL-exercises-in-LeetCode-easy-part/">点击这里</a></p>
<a id="more"></a>

<h3 id="177-Nth-Highest-Salary-第N高的薪水"><a href="#177-Nth-Highest-Salary-第N高的薪水" class="headerlink" title="177. Nth Highest Salary 第N高的薪水"></a>177. Nth Highest Salary 第N高的薪水</h3><p>题目描述：<a href="https://leetcode.com/problems/nth-highest-salary/" target="_blank" rel="noopener">https://leetcode.com/problems/nth-highest-salary/</a></p>
<p>解题思路：和取第二高的思路相同。先把相同薪水的都去重，然后逆序排序，使用LIMIT取第n高的薪水。</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SET</span> N=N<span class="number">-1</span>;</span><br><span class="line">  RETURN (</span><br><span class="line">      <span class="comment"># Write your MySQL query statement below.</span></span><br><span class="line">      <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Salary <span class="keyword">FROM</span> Employee <span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> N, <span class="number">1</span></span><br><span class="line">  );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
<p>这里<code>SET N=N-1</code>的意思是从第1个位置开始，往后取排在第N-1位置的薪水。比如取第2高的，则<code>LIMIT 1(N=2-1),1</code>，取第5高的，则<code>LIMIT 4(N=5-1),1</code></p>
<h3 id="178-Rank-Scores-分数排名"><a href="#178-Rank-Scores-分数排名" class="headerlink" title="178. Rank Scores 分数排名"></a>178. Rank Scores 分数排名</h3><p>题目描述：<a href="https://leetcode.com/problems/rank-scores/" target="_blank" rel="noopener">https://leetcode.com/problems/rank-scores/</a></p>
<p>解题思路：最简单的使用窗口函数dense_rank,在Oracle中可以通过，不过在MySQL中不能。<br>不用窗口函数实现的思路：<br>首先需要对分数表去重，统计共有第n个排名<br>然后把分数表分为两份sa和sb, 对于sa中分数sa.Score，统计去重后的sb表中有比sa.Score大的个数，即是sa.Score的排名。</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Oracle中</span></span><br><span class="line"><span class="keyword">SELECT</span> Score, <span class="keyword">DENSE_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>) <span class="keyword">AS</span> <span class="keyword">Rank</span></span><br><span class="line"><span class="keyword">FROM</span> Scores</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL</span></span><br><span class="line"><span class="keyword">SELECT</span> sa.Score, </span><br><span class="line">    (    </span><br><span class="line">        <span class="comment"># 统计去重后的sb表中有比sa.Score大的个数</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> sb.Score)</span><br><span class="line">        <span class="keyword">FROM</span> Scores <span class="keyword">AS</span> sb</span><br><span class="line">        <span class="keyword">WHERE</span> sb.Score &gt;= sa.Score</span><br><span class="line">    ) <span class="keyword">AS</span> <span class="keyword">Rank</span></span><br><span class="line"><span class="keyword">FROM</span> Scores <span class="keyword">AS</span> sa</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="180-Consecutive-Numbers连续出现的数字"><a href="#180-Consecutive-Numbers连续出现的数字" class="headerlink" title="180. Consecutive Numbers连续出现的数字"></a>180. Consecutive Numbers连续出现的数字</h3><p>题目描述：<a href="https://leetcode.com/problems/consecutive-numbers/" target="_blank" rel="noopener">https://leetcode.com/problems/consecutive-numbers/</a></p>
<p>解题思路：找出所有至少连续三次出现的数字，即id是连续至少三次的，且id对应的num是相同的。那么分为两步</p>
<p>首先判断id是连续至少三次的，可以将表自连接三份，如果表1的第n位的id = 表2的第n+1位的id-1，且表2的第n+1位的id=表3的第n+2位的id-1，那么就表示id是连续至少三次的。</p>
<p>然后判断id对应的num是否相同，即表1的第n位的id对应的num = 表2的第n+1位的id对应的num = 表3的第n+2位的id对应的num</p>
<p>代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Write your MySQL query statement below</span></span><br><span class="line"><span class="keyword">SELECT</span> L1.Num <span class="keyword">AS</span> ConsecutiveNums</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Logs</span> <span class="keyword">AS</span> L1, <span class="keyword">Logs</span> <span class="keyword">AS</span> L2, <span class="keyword">Logs</span> <span class="keyword">AS</span> L3</span><br><span class="line"><span class="keyword">WHERE</span> L1.Id = L2.Id<span class="number">-1</span> </span><br><span class="line">      <span class="keyword">AND</span> L2.Id = L3.Id<span class="number">-1</span></span><br><span class="line">      <span class="keyword">AND</span> L1.Num = L2.Num</span><br><span class="line">      <span class="keyword">AND</span> L2.Num = L3.Num;</span><br></pre></td></tr></table></figure>
<p>结果提示错误，报错原因：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">&#123;&quot;headers&quot;: &#123;&quot;Logs&quot;: [&quot;Id&quot;, &quot;Num&quot;]&#125;, &quot;rows&quot;: &#123;&quot;Logs&quot;: [[1, 3], [2, 3], [3, 3], [4, 3]]&#125;&#125;</span><br><span class="line">Output:</span><br><span class="line">&#123;&quot;headers&quot;: [&quot;ConsecutiveNums&quot;], &quot;values&quot;: [[3], [3]]&#125;</span><br><span class="line">Expected:</span><br><span class="line">&#123;&quot;headers&quot;:[&quot;ConsecutiveNums&quot;],&quot;values&quot;:[[3]]&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，如果连续出现4个3， 那么会有id为1-2-3的值为3和id为2-3-4的值为3，这两种情况，因此需要对结果去重，通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> L1.Num <span class="keyword">AS</span> ConsecutiveNums</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Logs</span> <span class="keyword">AS</span> L1, <span class="keyword">Logs</span> <span class="keyword">AS</span> L2, <span class="keyword">Logs</span> <span class="keyword">AS</span> L3</span><br><span class="line"><span class="keyword">WHERE</span> L1.Id = L2.Id<span class="number">-1</span> </span><br><span class="line">      <span class="keyword">AND</span> L2.Id = L3.Id<span class="number">-1</span></span><br><span class="line">      <span class="keyword">AND</span> L1.Num = L2.Num</span><br><span class="line">      <span class="keyword">AND</span> L2.Num = L3.Num;</span><br></pre></td></tr></table></figure>

<h3 id="184-Department-Highest-Salary部门工资最高的员工"><a href="#184-Department-Highest-Salary部门工资最高的员工" class="headerlink" title="184. Department Highest Salary部门工资最高的员工"></a>184. Department Highest Salary部门工资最高的员工</h3><p>题目描述：<a href="https://leetcode.com/problems/department-highest-salary/" target="_blank" rel="noopener">https://leetcode.com/problems/department-highest-salary/</a></p>
<p>解题思路：要求找出每个部门工资最高的。那么先按部门编号把部门分组，分组后求出每个部门工资最大的，即：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DepartmentId, <span class="keyword">MAX</span>(Salary)</span><br><span class="line"><span class="keyword">FROM</span> Employee</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> DepartmentId</span><br></pre></td></tr></table></figure>
<p>然后，把部门表和员工表联结，取出需要的信息</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.Name <span class="keyword">AS</span> Department, e.Name <span class="keyword">AS</span> Employee, e.Salary <span class="keyword">AS</span> Salary</span><br><span class="line"><span class="keyword">FROM</span> Employee <span class="keyword">AS</span> e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Department <span class="keyword">AS</span> d <span class="keyword">ON</span> e.DepartmentId = d.Id</span><br><span class="line"><span class="keyword">WHERE</span> (DepartmentId, Salary) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> DepartmentId, <span class="keyword">MAX</span>(Salary)</span><br><span class="line">    <span class="keyword">FROM</span> Employee </span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> DepartmentId</span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<h3 id="534-Game-Play-Analysis-III-游戏玩法分析-III"><a href="#534-Game-Play-Analysis-III-游戏玩法分析-III" class="headerlink" title="534    Game Play Analysis III 游戏玩法分析 III"></a>534    Game Play Analysis III 游戏玩法分析 III</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Table: Activity</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">(player_id, event_date) is the primary key of this table.</span><br><span class="line">This table shows the activity of players of some game.</span><br><span class="line">Each row is a record of a player who logged in and played a number of games (possibly 0) </span><br><span class="line">before logging out on some day using some device.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Write an SQL query that reports for each player and date, how many games played so far by the player.</span><br><span class="line">That is, the total number of games played by the player until that date. Check the example for clarity.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 1         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| player_id | event_date | games_played_so_far |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| 1         | 2016-03-01 | 5                   |</span><br><span class="line">| 1         | 2016-05-02 | 11                  |</span><br><span class="line">| 1         | 2017-06-25 | 12                  |</span><br><span class="line">| 3         | 2016-03-02 | 0                   |</span><br><span class="line">| 3         | 2018-07-03 | 5                   |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">For the player with id 1, 5 + 6 &#x3D; 11 games played by 2016-05-02, and 5 + 6 + 1 &#x3D; 12 games played by 2017-06-25.</span><br><span class="line">For the player with id 3, 0 + 5 &#x3D; 5 games played by 2018-07-03.</span><br><span class="line">Note that for each player we only care about the days when the player logged in.</span><br></pre></td></tr></table></figure>
<p>解题思路：累加和问题，题目要求出每个玩家在某个时期之前玩过的游戏个数累加和。<br>那么先找出某个日期之前的所有信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Activity <span class="keyword">AS</span> A1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Activity <span class="keyword">AS</span> A2</span><br><span class="line"><span class="keyword">ON</span> (A1.player_id = A2.player_id <span class="keyword">AND</span> A1.event_date &lt;= A2.event_date)</span><br></pre></td></tr></table></figure>
<p>再把玩家和该玩家在某个时期分组，求游戏个数之和。<br>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A2.player_id, A2.event_date, <span class="keyword">SUM</span>(A1.games_played) <span class="keyword">AS</span> games_played_so_far</span><br><span class="line"><span class="keyword">FROM</span> Activity <span class="keyword">AS</span> A1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Activity <span class="keyword">AS</span> A2 </span><br><span class="line"><span class="keyword">ON</span> (A1.player_id = A2.player_id <span class="keyword">AND</span> A1.event_date &lt;= A2.event_date)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A2.player_id, A2.event_date;</span><br></pre></td></tr></table></figure>

<h3 id="550-Game-Play-Analysis-IV-游戏玩法分析-IV"><a href="#550-Game-Play-Analysis-IV-游戏玩法分析-IV" class="headerlink" title="550    Game Play Analysis IV 游戏玩法分析 IV"></a>550    Game Play Analysis IV 游戏玩法分析 IV</h3><p>题目描述：    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Table: Activity</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">(player_id, event_date) is the primary key of this table.</span><br><span class="line">This table shows the activity of players of some game.</span><br><span class="line">Each row is a record of a player who logged in and played a number of games (possibly 0) before logging out on some day using some device.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query that reports the fraction of players that logged in again on the day after the day they first logged in, rounded to 2 decimal places. In other words, you need to count the number of players that logged in for at least two consecutive days starting from their first login date, then divide that number by the total number of players.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+</span><br><span class="line">| fraction  |</span><br><span class="line">+-----------+</span><br><span class="line">| 0.33      |</span><br><span class="line">+-----------+</span><br><span class="line">Only the player with id 1 logged back in after the first day he had logged in so the answer is 1&#x2F;3 &#x3D; 0.33</span><br></pre></td></tr></table></figure>
<p>题目要求出首次登陆后，第二天又登陆的人数占总人数的比例。<br>解题思路：</p>
<p>按照玩家id分组，找出每个玩家首次登陆和该玩家第二次登陆的时间，来判断是否连续，如果连续，计数器加1<br>将计数器得到的总和除以游戏总人数，得到比例，保留两位小数</p>
<p>首先找出每个玩家首次登陆的日期：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> player_id, <span class="keyword">MIN</span>(event_date)</span><br><span class="line"><span class="keyword">FROM</span> Activity</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br></pre></td></tr></table></figure>

<p>然后排除表中不是玩家首次登陆的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Activity</span><br><span class="line"><span class="keyword">WHERE</span> (player_id, event_date) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> player_id, <span class="keyword">MIN</span>(event_date)</span><br><span class="line">    <span class="keyword">FROM</span> Activity</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>再然后找出首次登陆后，该玩家第二天也登陆了，这里可以把Activity表自连接，B表时间作为A表时间的第二天，用DATEDIFF函数判断相邻一天。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Activity <span class="keyword">AS</span> A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Activity <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">ON</span> A.player_id = B.player_id <span class="keyword">AND</span> <span class="keyword">DATEDIFF</span>(B.event_date, A.event_date) = <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> (A.player_id, A.event_date) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> player_id, <span class="keyword">MIN</span>(event_date)</span><br><span class="line">    <span class="keyword">FROM</span> Activity</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>最后求出比例，用ROUND函数保留两位小数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> B.event_date) / <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> A.player_id), <span class="number">2</span>) <span class="keyword">AS</span> fraction</span><br><span class="line"><span class="keyword">FROM</span> Activity <span class="keyword">AS</span> A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Activity <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">ON</span> A.player_id = B.player_id <span class="keyword">AND</span> <span class="keyword">DATEDIFF</span>(B.event_date, A.event_date) = <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> (A.player_id, A.event_date) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> player_id, <span class="keyword">MIN</span>(event_date)</span><br><span class="line">    <span class="keyword">FROM</span> Activity</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="570-Managers-with-at-Least-5-Direct-Reports-至少有5名直接下属的经理"><a href="#570-Managers-with-at-Least-5-Direct-Reports-至少有5名直接下属的经理" class="headerlink" title="570    Managers with at Least 5 Direct Reports 至少有5名直接下属的经理"></a>570    Managers with at Least 5 Direct Reports 至少有5名直接下属的经理</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees including their managers. Every employee has an Id, and there is also a column for the manager Id.</span><br><span class="line"></span><br><span class="line">+------+----------+-----------+----------+</span><br><span class="line">|Id    |Name 	  |Department |ManagerId |</span><br><span class="line">+------+----------+-----------+----------+</span><br><span class="line">|101   |John 	  |A 	      |null      |</span><br><span class="line">|102   |Dan 	  |A 	      |101       |</span><br><span class="line">|103   |James 	  |A 	      |101       |</span><br><span class="line">|104   |Amy 	  |A 	      |101       |</span><br><span class="line">|105   |Anne 	  |A 	      |101       |</span><br><span class="line">|106   |Ron 	  |B 	      |101       |</span><br><span class="line">+------+----------+-----------+----------+</span><br><span class="line">Given the Employee table, write a SQL query that finds out managers with at least 5 direct report. For the above table, your SQL query should return:</span><br><span class="line"></span><br><span class="line">+-------+</span><br><span class="line">| Name  |</span><br><span class="line">+-------+</span><br><span class="line">| John  |</span><br><span class="line">+-------+</span><br><span class="line">Note:</span><br><span class="line">No one would report to himself.</span><br></pre></td></tr></table></figure>

<p>解题思路：求出至少有5个直接下属的经理。将Employee表按照经理id分组，使用HAVING过滤出下属至少5个的经理id，将这个查询结果作为临时表与原表内连接查询Name即可</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> E.Name</span><br><span class="line"><span class="keyword">FROM</span> Employee <span class="keyword">AS</span> E </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> ManagerId</span><br><span class="line">    <span class="keyword">FROM</span> Employee</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> ManagerId</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="keyword">Id</span>) &gt;= <span class="number">5</span></span><br><span class="line">    ) <span class="keyword">AS</span> M</span><br><span class="line"><span class="keyword">ON</span> E.Id = M.ManagerId;</span><br></pre></td></tr></table></figure>

<h3 id="574-Winning-Candidate-当选者"><a href="#574-Winning-Candidate-当选者" class="headerlink" title="574    Winning Candidate 当选者"></a>574    Winning Candidate 当选者</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Table: Candidate</span><br><span class="line"></span><br><span class="line">+-----+---------+</span><br><span class="line">| id  | Name    |</span><br><span class="line">+-----+---------+</span><br><span class="line">| 1   | A       |</span><br><span class="line">| 2   | B       |</span><br><span class="line">| 3   | C       |</span><br><span class="line">| 4   | D       |</span><br><span class="line">| 5   | E       |</span><br><span class="line">+-----+---------+  </span><br><span class="line">Table: Vote</span><br><span class="line"></span><br><span class="line">+-----+--------------+</span><br><span class="line">| id  | CandidateId  |</span><br><span class="line">+-----+--------------+</span><br><span class="line">| 1   |     2        |</span><br><span class="line">| 2   |     4        |</span><br><span class="line">| 3   |     3        |</span><br><span class="line">| 4   |     2        |</span><br><span class="line">| 5   |     5        |</span><br><span class="line">+-----+--------------+</span><br><span class="line">id is the auto-increment primary key,</span><br><span class="line">CandidateId is the id appeared in Candidate table.</span><br><span class="line">Write a sql to find the name of the winning candidate, the above example will return the winner B.</span><br><span class="line"></span><br><span class="line">+------+</span><br><span class="line">| Name |</span><br><span class="line">+------+</span><br><span class="line">| B    |</span><br><span class="line">+------+</span><br><span class="line">Notes:</span><br><span class="line"></span><br><span class="line">You may assume there is no tie, in other words there will be at most one winning candidate.</span><br></pre></td></tr></table></figure>

<p>解题思路：把Vote表按CandidateId分组，统计投票的个数，逆序取最高投票的CandidateId，这个id就是Candidate表中的id，对应的就是得票最多的候选人的名字。</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">Name</span> </span><br><span class="line"><span class="keyword">FROM</span> Candidate</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> t.CandidateId <span class="keyword">FROM</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> CandidateId</span><br><span class="line">		<span class="keyword">FROM</span> Vote</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> CandidateId</span><br><span class="line">		<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(*) <span class="keyword">DESC</span></span><br><span class="line">		<span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">    ) <span class="keyword">AS</span> t</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>注意IN ()内层的SELECT语句，需要额外嵌套一层，否则会报错：<br>Error Code: 1235. This version of MySQL doesn’t yet support ‘LIMIT &amp; IN/ALL/ANY/SOME subquery’</p>
<p>也可以这样写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">FROM</span> Candidate <span class="keyword">AS</span> C <span class="keyword">JOIN</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> V.CandidateId, <span class="keyword">COUNT</span>(V.id) <span class="keyword">AS</span> cnt</span><br><span class="line">    <span class="keyword">FROM</span> Vote <span class="keyword">AS</span> V</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> CandidateId</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> cnt <span class="keyword">DESC</span></span><br><span class="line">    <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">) <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">ON</span> C.id = T.CandidateId;</span><br></pre></td></tr></table></figure>
<h3 id="578-Get-Highest-Answer-Rate-Question-查询回答率最高的问题"><a href="#578-Get-Highest-Answer-Rate-Question-查询回答率最高的问题" class="headerlink" title="578    Get Highest Answer Rate Question 查询回答率最高的问题"></a>578    Get Highest Answer Rate Question 查询回答率最高的问题</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Get the highest answer rate question from a table survey_log with these columns: uid, action, question_id, answer_id, q_num, timestamp.</span><br><span class="line"></span><br><span class="line">uid means user id; action has these kind of values: &quot;show&quot;, &quot;answer&quot;, &quot;skip&quot;; answer_id is not null when action column is &quot;answer&quot;, while is null for &quot;show&quot; and &quot;skip&quot;; q_num is the numeral order of the question in current session.</span><br><span class="line"></span><br><span class="line">Write a sql query to identify the question which has the highest answer rate.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line">Input:</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| uid  | action    | question_id  | answer_id  | q_num     | timestamp  |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| 5    | show      | 285          | null       | 1         | 123        |</span><br><span class="line">| 5    | answer    | 285          | 124124     | 1         | 124        |</span><br><span class="line">| 5    | show      | 369          | null       | 2         | 125        |</span><br><span class="line">| 5    | skip      | 369          | null       | 2         | 126        |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">Output:</span><br><span class="line">+-------------+</span><br><span class="line">| survey_log  |</span><br><span class="line">+-------------+</span><br><span class="line">|    285      |</span><br><span class="line">+-------------+</span><br><span class="line">Explanation:</span><br><span class="line">question 285 has answer rate 1&#x2F;1, while question 369 has 0&#x2F;1 answer rate, so output 285.</span><br><span class="line"></span><br><span class="line">Note: The highest answer rate meaning is: answer number&#39;s ratio in show number in the same question.</span><br></pre></td></tr></table></figure>

<p>解题思路：题目要求出回答率最高的问题。首先，题目中表达的action的三个动作的含义，每个问题都有show，该问题下可以选择回答answer和跳过skip，因此，某个问题的<code>回答率 = answer的个数 / show的个数</code>， 然后把问题id分组，每个问题计算其answer的个数，和show的个数，进而得到回答率，将每个问题的回答率逆序排序，取第一个就是最高的回答率</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> question_id <span class="keyword">AS</span> survey_log</span><br><span class="line"><span class="keyword">FROM</span> survey_log</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'answer'</span>, <span class="number">1</span>, <span class="number">0</span>)) / <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'show'</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>除了用SUM IF，还可以用CASE WHEN方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> question_id <span class="keyword">AS</span> <span class="string">'survey_log'</span></span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> question_id, </span><br><span class="line">           <span class="keyword">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">action</span>=<span class="string">'answer'</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> num_answer,</span><br><span class="line">           <span class="keyword">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">action</span>=<span class="string">'show'</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> num_show</span><br><span class="line">    <span class="keyword">FROM</span> survey_log</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line">    ) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (num_answer / num_show) <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="580-Count-Student-Number-in-Departments-统计各专业学生人数"><a href="#580-Count-Student-Number-in-Departments-统计各专业学生人数" class="headerlink" title="580    Count Student Number in Departments 统计各专业学生人数"></a>580    Count Student Number in Departments 统计各专业学生人数</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">A university uses 2 data tables, student and department, to store data about its students and the departments associated with each major.</span><br><span class="line"></span><br><span class="line">Write a query to print the respective department name and number of students majoring in each department for all departments in the department table (even ones with no current students).</span><br><span class="line"></span><br><span class="line">Sort your results by descending number of students; if two or more departments have the same number of students, then sort those departments alphabetically by department name.</span><br><span class="line"></span><br><span class="line">The student is described as follow:</span><br><span class="line"></span><br><span class="line">| Column Name  | Type      |</span><br><span class="line">|--------------|-----------|</span><br><span class="line">| student_id   | Integer   |</span><br><span class="line">| student_name | String    |</span><br><span class="line">| gender       | Character |</span><br><span class="line">| dept_id      | Integer   |</span><br><span class="line">where student_id is the student&#39;s ID number, student_name is the student&#39;s name, gender is their gender, and dept_id is the department ID associated with their declared major.</span><br><span class="line"></span><br><span class="line">And the department table is described as below:</span><br><span class="line"></span><br><span class="line">| Column Name | Type    |</span><br><span class="line">|-------------|---------|</span><br><span class="line">| dept_id     | Integer |</span><br><span class="line">| dept_name   | String  |</span><br><span class="line">where dept_id is the department&#39;s ID number and dept_name is the department name.</span><br><span class="line"></span><br><span class="line">Here is an example input:</span><br><span class="line">student table:</span><br><span class="line"></span><br><span class="line">| student_id | student_name | gender | dept_id |</span><br><span class="line">|------------|--------------|--------|---------|</span><br><span class="line">| 1          | Jack         | M      | 1       |</span><br><span class="line">| 2          | Jane         | F      | 1       |</span><br><span class="line">| 3          | Mark         | M      | 2       |</span><br><span class="line">department table:</span><br><span class="line"></span><br><span class="line">| dept_id | dept_name   |</span><br><span class="line">|---------|-------------|</span><br><span class="line">| 1       | Engineering |</span><br><span class="line">| 2       | Science     |</span><br><span class="line">| 3       | Law         |</span><br><span class="line">The Output should be:</span><br><span class="line"></span><br><span class="line">| dept_name   | student_number |</span><br><span class="line">|-------------|----------------|</span><br><span class="line">| Engineering | 2              |</span><br><span class="line">| Science     | 1              |</span><br><span class="line">| Law         | 0              |</span><br></pre></td></tr></table></figure>

<p>解题思路：先把部门左连接学生，然后按部门分组，统计每个部门组内的学生，然后按学生数量由高到低排序。</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> D.dept_name, <span class="keyword">COUNT</span>(S.student_id) <span class="keyword">AS</span> student_number</span><br><span class="line"><span class="keyword">FROM</span> department <span class="keyword">AS</span> D <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student <span class="keyword">AS</span> S</span><br><span class="line"><span class="keyword">ON</span> D.dept_id = S.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> D.dept_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> student_number <span class="keyword">DESC</span>, D.dept_name;</span><br></pre></td></tr></table></figure>

<h3 id="585-Investments-in-2016-2016年的投资"><a href="#585-Investments-in-2016-2016年的投资" class="headerlink" title="585    Investments in 2016 2016年的投资"></a>585    Investments in 2016 2016年的投资</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Write a query to print the sum of all total investment values in 2016 (TIV_2016), to a scale of 2 decimal places, for all policy holders who meet the following criteria:</span><br><span class="line"></span><br><span class="line">Have the same TIV_2015 value as one or more other policyholders.</span><br><span class="line">Are not located in the same city as any other policyholder (i.e.: the (latitude, longitude) attribute pairs must be unique).</span><br><span class="line">Input Format:</span><br><span class="line">The insurance table is described as follows:</span><br><span class="line"></span><br><span class="line">| Column Name | Type          |</span><br><span class="line">|-------------|---------------|</span><br><span class="line">| PID         | INTEGER(11)   |</span><br><span class="line">| TIV_2015    | NUMERIC(15,2) |</span><br><span class="line">| TIV_2016    | NUMERIC(15,2) |</span><br><span class="line">| LAT         | NUMERIC(5,2)  |</span><br><span class="line">| LON         | NUMERIC(5,2)  |</span><br><span class="line">where PID is the policyholder&#39;s policy ID, TIV_2015 is the total investment value in 2015, TIV_2016 is the total investment value in 2016, LAT is the latitude of the policy holder&#39;s city, and LON is the longitude of the policy holder&#39;s city.</span><br><span class="line"></span><br><span class="line">Sample Input</span><br><span class="line"></span><br><span class="line">| PID | TIV_2015 | TIV_2016 | LAT | LON |</span><br><span class="line">|-----|----------|----------|-----|-----|</span><br><span class="line">| 1   | 10       | 5        | 10  | 10  |</span><br><span class="line">| 2   | 20       | 20       | 20  | 20  |</span><br><span class="line">| 3   | 10       | 30       | 20  | 20  |</span><br><span class="line">| 4   | 10       | 40       | 40  | 40  |</span><br><span class="line">Sample Output</span><br><span class="line"></span><br><span class="line">| TIV_2016 |</span><br><span class="line">|----------|</span><br><span class="line">| 45.00    |</span><br><span class="line">Explanation</span><br><span class="line"></span><br><span class="line">The first record in the table, like the last record, meets both of the two criteria.</span><br><span class="line">The TIV_2015 value &#39;10&#39; is as the same as the third and forth record, and its location unique.</span><br><span class="line"></span><br><span class="line">The second record does not meet any of the two criteria. Its TIV_2015 is not like any other policyholders.</span><br><span class="line"></span><br><span class="line">And its location is the same with the third record, which makes the third record fail, too.</span><br><span class="line"></span><br><span class="line">So, the result is the sum of TIV_2016 of the first and last record, which is 45.</span><br></pre></td></tr></table></figure>
<p>解题思路：首先读题都不明白，看别人的翻译后才明白。在2016年投资成功的条件是：</p>
<ul>
<li>和一个或多个投保人有相同的TIV_2015。</li>
<li>不和其他投保人在同一城市（就是说（纬度，经度）必须唯一）。</li>
</ul>
<p>其中，PID是投保人ID，TIV_2015是2015年投资总额，TIV_2016是2016年投资总额，LAT是投保人城市纬度，LON是投保人城市经度。</p>
<p>第一条，在 2015 年的投保额 (TIV_2015) 至少跟一个其他投保人在 2015 年的投保额相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TIV_2015</span><br><span class="line"><span class="keyword">FROM</span> insurance</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> TIV_2015</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>第二条，（纬度，经度）必须唯一</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(LAT, LON)</span><br><span class="line"><span class="keyword">FROM</span> insurance</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> LAT,LON</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>将符合这两个条件的TIV_2016值加起来，就是2016年的投资</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(TIV_2016) <span class="keyword">AS</span> TIV_2016</span><br><span class="line"><span class="keyword">FROM</span> insurance</span><br><span class="line"><span class="keyword">WHERE</span> TIV_2015 <span class="keyword">IN</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> TIV_2015</span><br><span class="line">        <span class="keyword">FROM</span> insurance</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> TIV_2015</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">1</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">CONCAT</span>(LAT, LON) <span class="keyword">IN</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(LAT, LON)</span><br><span class="line">        <span class="keyword">FROM</span> insurance</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> LAT,LON</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) = <span class="number">1</span></span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<h3 id="602-Friend-Requests-II-Who-Has-the-Most-Friends-好友申请-II-：谁有最多的好友"><a href="#602-Friend-Requests-II-Who-Has-the-Most-Friends-好友申请-II-：谁有最多的好友" class="headerlink" title="602 Friend Requests II: Who Has the Most Friends 好友申请 II ：谁有最多的好友"></a>602 Friend Requests II: Who Has the Most Friends 好友申请 II ：谁有最多的好友</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In social network like Facebook or Twitter, people send friend requests and accept others&#39; requests as well.</span><br><span class="line"></span><br><span class="line">Table request_accepted holds the data of friend acceptance, while requester_id and accepter_id both are the id of a person.</span><br><span class="line"> </span><br><span class="line">| requester_id | accepter_id | accept_date|</span><br><span class="line">|--------------|-------------|------------|</span><br><span class="line">| 1            | 2           | 2016_06-03 |</span><br><span class="line">| 1            | 3           | 2016-06-08 |</span><br><span class="line">| 2            | 3           | 2016-06-08 |</span><br><span class="line">| 3            | 4           | 2016-06-09 |</span><br><span class="line">Write a query to find the the people who has most friends and the most friends number. For the sample data above, the result is:</span><br><span class="line">| id | num |</span><br><span class="line">|----|-----|</span><br><span class="line">| 3  | 3   |</span><br><span class="line">Note:</span><br><span class="line">It is guaranteed there is only 1 people having the most friends.</span><br><span class="line">The friend request could only been accepted once, which mean there is no multiple records with the same requester_id and accepter_id value.</span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">The person with id &#39;3&#39; is a friend of people &#39;1&#39;, &#39;2&#39; and &#39;4&#39;, so he has 3 friends in total, which is the most number than any others.</span><br><span class="line"></span><br><span class="line">Follow-up:</span><br><span class="line">In the real world, multiple people could have the same most number of friends, can you find all these people in this case?</span><br></pre></td></tr></table></figure>
<p>题目要求出谁有最多的好友，及他的好友数量。<br>解题思路：这个题没有思路，看别人写的:</p>
<p>用UNION ALL把请求id和接受id都找出来：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> requester_id <span class="keyword">AS</span> <span class="keyword">id</span> <span class="keyword">FROM</span> request_accepted</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> accepter_id <span class="keyword">AS</span> <span class="keyword">id</span> <span class="keyword">FROM</span> request_accepted</span><br></pre></td></tr></table></figure>
<p>然后按id分组，计算每个id出现的次数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.id, <span class="keyword">COUNT</span>(t.id) <span class="keyword">AS</span> <span class="keyword">num</span> </span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> requester_id <span class="keyword">AS</span> <span class="keyword">id</span> <span class="keyword">FROM</span> request_accepted</span><br><span class="line">        <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">        <span class="keyword">SELECT</span> accepter_id <span class="keyword">AS</span> <span class="keyword">id</span> <span class="keyword">FROM</span> request_accepted</span><br><span class="line">    ) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> t.id</span><br></pre></td></tr></table></figure>
<p>最后，根据出现次数降序排列，第一条就是好友数量最多的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.id, <span class="keyword">COUNT</span>(t.id) <span class="keyword">AS</span> <span class="keyword">num</span> </span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> requester_id <span class="keyword">AS</span> <span class="keyword">id</span> <span class="keyword">FROM</span> request_accepted</span><br><span class="line">        <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">        <span class="keyword">SELECT</span> accepter_id <span class="keyword">AS</span> <span class="keyword">id</span> <span class="keyword">FROM</span> request_accepted</span><br><span class="line">    ) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> t.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">num</span> <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="608-Tree-Node-树节点"><a href="#608-Tree-Node-树节点" class="headerlink" title="608    Tree Node 树节点"></a>608    Tree Node 树节点</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Given a table tree, id is identifier of the tree node and p_id is its parent node id.</span><br><span class="line"></span><br><span class="line">+----+------+</span><br><span class="line">| id | p_id |</span><br><span class="line">+----+------+</span><br><span class="line">| 1  | null |</span><br><span class="line">| 2  | 1    |</span><br><span class="line">| 3  | 1    |</span><br><span class="line">| 4  | 2    |</span><br><span class="line">| 5  | 2    |</span><br><span class="line">+----+------+</span><br><span class="line">Each node in the tree can be one of three types:</span><br><span class="line">Leaf: if the node is a leaf node.</span><br><span class="line">Root: if the node is the root of the tree.</span><br><span class="line">Inner: If the node is neither a leaf node nor a root node.</span><br><span class="line"></span><br><span class="line">Write a query to print the node id and the type of the node. Sort your output by the node id. The result for the above sample is:</span><br><span class="line"></span><br><span class="line">+----+------+</span><br><span class="line">| id | Type |</span><br><span class="line">+----+------+</span><br><span class="line">| 1  | Root |</span><br><span class="line">| 2  | Inner|</span><br><span class="line">| 3  | Leaf |</span><br><span class="line">| 4  | Leaf |</span><br><span class="line">| 5  | Leaf |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">Explanation</span><br><span class="line"></span><br><span class="line">Node &#39;1&#39; is root node, because its parent node is NULL and it has child node &#39;2&#39; and &#39;3&#39;.</span><br><span class="line">Node &#39;2&#39; is inner node, because it has parent node &#39;1&#39; and child node &#39;4&#39; and &#39;5&#39;.</span><br><span class="line">Node &#39;3&#39;, &#39;4&#39; and &#39;5&#39; is Leaf node, because they have parent node and they don&#39;t have child node.</span><br><span class="line"></span><br><span class="line">And here is the image of the sample tree as below:</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">	      1</span><br><span class="line">	    &#x2F;   \</span><br><span class="line">           2     3</span><br><span class="line">         &#x2F;   \</span><br><span class="line">        4     5</span><br><span class="line"></span><br><span class="line">Note:</span><br><span class="line">If there is only one node on the tree, you only need to output its root attributes.</span><br></pre></td></tr></table></figure>

<p>解题思路：节点类型判断依据：没有父节点的是根Root，没有子节点的是叶Leaf，其他是内部节点Inner</p>
<p>首先找出根节点的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="string">'Root'</span> <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">WHERE</span> p_id <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>然后找出叶节点，叶节点有两个条件，一个是它的父节点不空，第二个是它不是父节点：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="string">'Leaf'</span> <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> p_id</span><br><span class="line">    <span class="keyword">FROM</span> tree</span><br><span class="line">    <span class="keyword">WHERE</span> p_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>最后找出内部节点，内部节点的条件，一个是它的父节点不空，第二个是它本身也是父节点：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="string">'Inner'</span> <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> p_id</span><br><span class="line">        <span class="keyword">FROM</span> tree</span><br><span class="line">        <span class="keyword">WHERE</span> p_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">    ) </span><br><span class="line"><span class="keyword">AND</span> p_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<p>将这三个结果用union连接起来，得到题目要求的结果。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="string">'Root'</span> <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">WHERE</span> p_id <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="string">'Leaf'</span> <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> p_id</span><br><span class="line">    <span class="keyword">FROM</span> tree</span><br><span class="line">    <span class="keyword">WHERE</span> p_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="string">'Inner'</span> <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> p_id</span><br><span class="line">        <span class="keyword">FROM</span> tree</span><br><span class="line">        <span class="keyword">WHERE</span> p_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">    ) </span><br><span class="line"><span class="keyword">AND</span> p_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br></pre></td></tr></table></figure>

<p>第二种方法，使用CASE WHEN语句来实现</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,</span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">CASE</span> <span class="keyword">WHEN</span> p_id <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">THEN</span> <span class="string">'Root'</span></span><br><span class="line">                 <span class="keyword">WHEN</span> <span class="keyword">id</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> p_id <span class="keyword">FROM</span> tree) <span class="keyword">THEN</span> <span class="string">'Inner'</span></span><br><span class="line">                 <span class="keyword">ELSE</span> <span class="string">'Leaf'</span></span><br><span class="line">            <span class="keyword">END</span></span><br><span class="line">        ) <span class="keyword">AS</span> Tpye</span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br></pre></td></tr></table></figure>

<p>第三种方法，把CASE WHEN换成IF语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">IF</span>(<span class="keyword">ISNULL</span>(p_id), <span class="string">'Root'</span>, <span class="keyword">IF</span>(<span class="keyword">id</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> p_id <span class="keyword">FROM</span> tree), <span class="string">'Inner'</span>, <span class="string">'Leaf'</span>)) <span class="keyword">AS</span> <span class="keyword">Type</span></span><br><span class="line"><span class="keyword">FROM</span> tree</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br></pre></td></tr></table></figure>

<h3 id="612-Shortest-Distance-in-a-Plane-平面上的最近距离"><a href="#612-Shortest-Distance-in-a-Plane-平面上的最近距离" class="headerlink" title="612    Shortest Distance in a Plane 平面上的最近距离"></a>612    Shortest Distance in a Plane 平面上的最近距离</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Table point_2d holds the coordinates (x,y) of some unique points (more than two) in a plane.</span><br><span class="line"></span><br><span class="line">Write a query to find the shortest distance between these points rounded to 2 decimals.</span><br><span class="line"></span><br><span class="line">| x  | y  |</span><br><span class="line">|----|----|</span><br><span class="line">| -1 | -1 |</span><br><span class="line">| 0  | 0  |</span><br><span class="line">| -1 | -2 |</span><br><span class="line"></span><br><span class="line">The shortest distance is 1.00 from point (-1,-1) to (-1,2). So the output should be:</span><br><span class="line"></span><br><span class="line">| shortest |</span><br><span class="line">|----------|</span><br><span class="line">| 1.00     |</span><br><span class="line"></span><br><span class="line">Note: The longest distance among all the points are less than 10000.</span><br></pre></td></tr></table></figure>

<p>解题思路：有平面上两点的坐标，应用两点之间的距离公式。</p>
<p><img src="https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/pic/item/11385343fbf2b211594f214ac38065380cd78e55.jpg" alt="img"></p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(</span><br><span class="line">         <span class="keyword">SQRT</span>( <span class="keyword">MIN</span>( <span class="keyword">POWER</span>(p1.x - p2.x, <span class="number">2</span>) + <span class="keyword">POWER</span>(p1.y - p2.y, <span class="number">2</span>) )</span><br><span class="line">        ), <span class="number">2</span>) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span> point_2d <span class="keyword">AS</span> p1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> point_2d <span class="keyword">AS</span> p2</span><br><span class="line"><span class="keyword">ON</span> p1.x != p2.x <span class="keyword">OR</span> p1.y != p2.y</span><br></pre></td></tr></table></figure>
<p>这里注意表自连接后需要排除点与自身点的距离这种情况，比如(-1,-1)到(-1,-1)这样的</p>
<h3 id="614-Second-Degree-Follower-二级关注者"><a href="#614-Second-Degree-Follower-二级关注者" class="headerlink" title="614    Second Degree Follower 二级关注者"></a>614    Second Degree Follower 二级关注者</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In facebook, there is a follow table with two columns: followee, follower.</span><br><span class="line"></span><br><span class="line">Please write a sql query to get the amount of each follower’s follower if he&#x2F;she has one.</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line"></span><br><span class="line">+-------------+------------+</span><br><span class="line">| followee    | follower   |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     A       |     B      |</span><br><span class="line">|     B       |     C      |</span><br><span class="line">|     B       |     D      |</span><br><span class="line">|     D       |     E      |</span><br><span class="line">+-------------+------------+</span><br><span class="line">should output:</span><br><span class="line">+-------------+------------+</span><br><span class="line">| follower    | num        |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     B       |  2         |</span><br><span class="line">|     D       |  1         |</span><br><span class="line">+-------------+------------+</span><br><span class="line">Explaination:</span><br><span class="line">Both B and D exist in the follower list, when as a followee, B&#39;s follower is C and D, and D&#39;s follower is E. A does not exist in follower list.</span><br><span class="line"></span><br><span class="line">Note:</span><br><span class="line">Followee would not follow himself&#x2F;herself in all cases.</span><br><span class="line">Please display the result in follower&#39;s alphabet order.</span><br></pre></td></tr></table></figure>

<p>解题思路：follower的follower数量??表有两列，一列是关注者follower，一列是被关注者followee， 关注者本身也可以被其他人关注，求出每一个被关注者的二次关注者（second-degree follower）个数。</p>
<p>首先将表自连接，找出关注者follower被哪些人关注followee：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> follow <span class="keyword">AS</span> F1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> follow <span class="keyword">AS</span> F2</span><br><span class="line"><span class="keyword">ON</span> F1.follower = F2.followee;</span><br></pre></td></tr></table></figure>
<p>得到的结果如下，比如B，B是A的关注者(可以理解为粉丝)， 同时，B又被C关注，即C是B的粉丝，B也被D关注，所以B的num是2。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----------+----------+----------+----------+</span><br><span class="line">| followee | follower | followee | follower |</span><br><span class="line">+----------+----------+----------+----------+</span><br><span class="line">| A        | B        | B        | C        |</span><br><span class="line">| A        | B        | B        | D        |</span><br><span class="line">| B        | D        | D        | E        |</span><br><span class="line">+----------+----------+----------+----------+</span><br></pre></td></tr></table></figure>
<p>那么接下来把这张表按关注者F1.follower分组，统计组内个数即num</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> F1.follower, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> F2.follower) <span class="keyword">AS</span> <span class="string">'num'</span></span><br><span class="line"><span class="keyword">FROM</span> follow <span class="keyword">AS</span> F1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> follow <span class="keyword">AS</span> F2</span><br><span class="line"><span class="keyword">ON</span> F1.follower = F2.followee</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> F1.follower;</span><br></pre></td></tr></table></figure>

<h3 id="626-Exchange-Seats-换座位"><a href="#626-Exchange-Seats-换座位" class="headerlink" title="626. Exchange Seats 换座位"></a>626. Exchange Seats 换座位</h3><p>题目描述：<a href="https://leetcode.com/problems/exchange-seats/" target="_blank" rel="noopener">https://leetcode.com/problems/exchange-seats/</a></p>
<p>解题思路：这个没有思路，看了别人的解答后才会的。题中表的内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+</span><br><span class="line">|    id   | student |</span><br><span class="line">+---------+---------+</span><br><span class="line">|    1    | Abbot   |</span><br><span class="line">|    2    | Doris   |</span><br><span class="line">|    3    | Emerson |</span><br><span class="line">|    4    | Green   |</span><br><span class="line">|    5    | Jeames  |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure>
<p>要输出的内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+</span><br><span class="line">|    id   | student |</span><br><span class="line">+---------+---------+</span><br><span class="line">|    1    | Doris   |</span><br><span class="line">|    2    | Abbot   |</span><br><span class="line">|    3    | Green   |</span><br><span class="line">|    4    | Emerson |</span><br><span class="line">|    5    | Jeames  |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure>
<p>要求id相邻的更换学生名字，原先id=2的学生名字，更换为id=1；原先id=1的学生名字，更换为id=2的</p>
<p>那么可以推导出：</p>
<ul>
<li>如果id=偶数，则将其id-1</li>
<li>如果id=奇数且是最后一个，则id不变； </li>
<li>如果id=奇数且不是最后一个，则id+1</li>
</ul>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> (<span class="keyword">CASE</span> <span class="keyword">mod</span>(<span class="keyword">id</span>, <span class="number">2</span>) </span><br><span class="line">       <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="keyword">id</span><span class="number">-1</span></span><br><span class="line">       <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="keyword">id</span> = (<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> seat) <span class="keyword">THEN</span> <span class="keyword">id</span></span><br><span class="line">       <span class="keyword">ELSE</span> <span class="keyword">id</span>+<span class="number">1</span></span><br><span class="line">       <span class="keyword">END</span>) <span class="keyword">AS</span> <span class="keyword">id</span>, student</span><br><span class="line"><span class="keyword">FROM</span> seat</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1045-Customers-Who-Bought-All-Products-买下所有产品的客户"><a href="#1045-Customers-Who-Bought-All-Products-买下所有产品的客户" class="headerlink" title="1045 Customers Who Bought All Products 买下所有产品的客户"></a>1045 Customers Who Bought All Products 买下所有产品的客户</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Table: Customer</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| customer_id | int     |</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key is a foreign key to Product table.</span><br><span class="line">Table: Product</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key is the primary key column for this table.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query for a report that provides the customer ids from the Customer table that bought all the products in the Product table.</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line"></span><br><span class="line">Customer table:</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| customer_id | product_key |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 5           |</span><br><span class="line">| 2           | 6           |</span><br><span class="line">| 3           | 5           |</span><br><span class="line">| 3           | 6           |</span><br><span class="line">| 1           | 6           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Product table:</span><br><span class="line">+-------------+</span><br><span class="line">| product_key |</span><br><span class="line">+-------------+</span><br><span class="line">| 5           |</span><br><span class="line">| 6           |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| customer_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">| 3           |</span><br><span class="line">+-------------+</span><br><span class="line">The customers who bought all the products (5 and 6) are customers with id 1 and 3.</span><br></pre></td></tr></table></figure>

<p>解题思路：找出买了所有商品的用户。先把用户分组，计算每个用户买的商品数量。然后计算商品表中的总数量。最后如果这两个数量相等，那就是全买了</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> customer_id</span><br><span class="line"><span class="keyword">FROM</span> Customer</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> product_key) = (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> product_key) <span class="keyword">FROM</span> Product</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="1070-Product-Sales-Analysis-III-产品销售分析-III"><a href="#1070-Product-Sales-Analysis-III-产品销售分析-III" class="headerlink" title="1070 Product Sales Analysis III 产品销售分析 III"></a>1070 Product Sales Analysis III 产品销售分析 III</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Table: Sales</span><br><span class="line"></span><br><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">sale_id is the primary key of this table.</span><br><span class="line">product_id is a foreign key to Product table.</span><br><span class="line">Note that the price is per unit.</span><br><span class="line">Table: Product</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id is the primary key of this table.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query that selects the product id, year, quantity, and price for the first year of every product sold.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+------------+----------+-------+</span><br><span class="line">| product_id | first_year | quantity | price |</span><br><span class="line">+------------+------------+----------+-------+ </span><br><span class="line">| 100        | 2008       | 10       | 5000  |</span><br><span class="line">| 200        | 2011       | 15       | 9000  |</span><br><span class="line">+------------+------------+----------+-------+</span><br></pre></td></tr></table></figure>

<p>解题思路：最开始是这样写的，但是不对</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id, <span class="keyword">MIN</span>(<span class="keyword">year</span>) <span class="keyword">AS</span> first_year, quantity, price</span><br><span class="line"><span class="keyword">FROM</span> Sales</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id;</span><br></pre></td></tr></table></figure>

<p>不对的原因是MIN(year)只关注一个值，而不是一行值。本题要求每个产品第一年的记录，应该需要把产品id和年份绑定在一起。</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id, <span class="keyword">year</span> <span class="keyword">AS</span> first_year, quantity, price</span><br><span class="line"><span class="keyword">FROM</span> Sales</span><br><span class="line"><span class="keyword">WHERE</span> (product_id, <span class="keyword">year</span>) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> product_id, <span class="keyword">MIN</span>(<span class="keyword">year</span>) </span><br><span class="line">    <span class="keyword">FROM</span> Sales</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="1077-Project-Employees-III-项目员工-III"><a href="#1077-Project-Employees-III-项目员工-III" class="headerlink" title="1077 Project Employees III     项目员工 III"></a>1077 Project Employees III     项目员工 III</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Table: Project</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(project_id, employee_id) is the primary key of this table.</span><br><span class="line">employee_id is a foreign key to Employee table.</span><br><span class="line"></span><br><span class="line">Table: Employee</span><br><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">employee_id is the primary key of this table.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query that reports the most experienced employees in each project. </span><br><span class="line">In case of a tie, report all employees with the maximum number of experience years.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Project table:</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 3                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | employee_id   |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 1           | 3             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">Both employees with id 1 and 3 have the most experience among the employees of the first project. </span><br><span class="line">For the second project, the employee with id 1 has the most experience.</span><br></pre></td></tr></table></figure>

<p>解题思路：找出每个项目里工作经验最多的员工。先把项目表和员工表连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Project</span> <span class="keyword">AS</span> P <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> E</span><br><span class="line"><span class="keyword">ON</span> P.employee_id = E.employee_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> P.project_id;</span><br></pre></td></tr></table></figure>
<p>得到的结果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------+-------------+-------------+------+------------------+</span><br><span class="line">| project_id | employee_id | employee_id | name | experience_years |</span><br><span class="line">+------------+-------------+-------------+------+------------------+</span><br><span class="line">|          1 |           1 |           1 | Kh   |                3 |</span><br><span class="line">|          1 |           2 |           2 | Al   |                2 |</span><br><span class="line">|          1 |           3 |           3 | Jo   |                3 |</span><br><span class="line">|          2 |           1 |           1 | Kh   |                3 |</span><br><span class="line">|          2 |           4 |           4 | Do   |                2 |</span><br><span class="line">+------------+-------------+-------------+------+------------------+</span><br></pre></td></tr></table></figure>
<p>然后把项目分组，找出每个项目中经验最多的是多少年的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> P.project_id, <span class="keyword">MAX</span>(E.experience_years)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Project</span> <span class="keyword">AS</span> P <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> E</span><br><span class="line"><span class="keyword">ON</span> P.employee_id = E.employee_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> P.project_id;</span><br></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------------+-------------------------+</span><br><span class="line">| project_id | MAX(E.experience_years) |</span><br><span class="line">+------------+-------------------------+</span><br><span class="line">|          1 |                       3 |</span><br><span class="line">|          2 |                       3 |</span><br><span class="line">+------------+-------------------------+</span><br></pre></td></tr></table></figure>
<p>最后找出项目表中的项目id和员工表中的员工id，其中员工是工作经验最多的</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> P.project_id, E.employee_id</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Project</span> <span class="keyword">AS</span> P <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> E</span><br><span class="line"><span class="keyword">ON</span> P.employee_id = E.employee_id</span><br><span class="line"><span class="keyword">WHERE</span> (P.project_id, E.experience_years) <span class="keyword">IN</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> P.project_id, <span class="keyword">MAX</span>(E.experience_years)</span><br><span class="line">        <span class="keyword">FROM</span> <span class="keyword">Project</span> <span class="keyword">AS</span> P <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> E</span><br><span class="line">        <span class="keyword">ON</span> P.employee_id = E.employee_id</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> P.project_id</span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<h3 id="1098-Unpopular-Books-小众书籍"><a href="#1098-Unpopular-Books-小众书籍" class="headerlink" title="1098 Unpopular Books  小众书籍"></a>1098 Unpopular Books  小众书籍</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">Table: Books</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">| available_from | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">book_id is the primary key of this table.</span><br><span class="line"></span><br><span class="line">Table: Orders</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| order_id       | int     |</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| quantity       | int     |</span><br><span class="line">| dispatch_date  | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">order_id is the primary key of this table.</span><br><span class="line">book_id is a foreign key to the Books table.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query that reports the books that have sold less than 10 copies in the last year, excluding books that have been available for less than 1 month from today. Assume today is 2019-06-23.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Books table:</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line">| book_id | name               | available_from |</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line">| 1       | &quot;Kalila And Demna&quot; | 2010-01-01     |</span><br><span class="line">| 2       | &quot;28 Letters&quot;       | 2012-05-12     |</span><br><span class="line">| 3       | &quot;The Hobbit&quot;       | 2019-06-10     |</span><br><span class="line">| 4       | &quot;13 Reasons Why&quot;   | 2019-06-01     |</span><br><span class="line">| 5       | &quot;The Hunger Games&quot; | 2008-09-21     |</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line">| order_id | book_id | quantity | dispatch_date |</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line">| 1        | 1       | 2        | 2018-07-26    |</span><br><span class="line">| 2        | 1       | 1        | 2018-11-05    |</span><br><span class="line">| 3        | 3       | 8        | 2019-06-11    |</span><br><span class="line">| 4        | 4       | 6        | 2019-06-05    |</span><br><span class="line">| 5        | 4       | 5        | 2019-06-20    |</span><br><span class="line">| 6        | 5       | 9        | 2009-02-02    |</span><br><span class="line">| 7        | 5       | 8        | 2010-04-13    |</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| book_id   | name               |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| 1         | &quot;Kalila And Demna&quot; |</span><br><span class="line">| 2         | &quot;28 Letters&quot;       |</span><br><span class="line">| 5         | &quot;The Hunger Games&quot; |</span><br><span class="line">+-----------+--------------------+</span><br></pre></td></tr></table></figure>

<p>解题思路：找出去年到今天销量少于10的书id和名字，最近一个月才开始卖的除外。</p>
<p>先找出去年到今天，并且排除掉最近一个月的卖书情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> books <span class="keyword">AS</span> B <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders <span class="keyword">AS</span> O</span><br><span class="line"><span class="keyword">ON</span> O.book_id = B.book_id <span class="keyword">AND</span> O.dispatch_date <span class="keyword">BETWEEN</span> <span class="string">'2018-06-23'</span> <span class="keyword">AND</span> <span class="string">'2019-06-23'</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2019-06-23'</span>, B.available_from) &gt; <span class="number">30</span>;</span><br></pre></td></tr></table></figure>
<p>得到的卖书情况如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------+------+----------------+----------+---------+----------+---------------+</span><br><span class="line">| book_id | name | available_from | order_id | book_id | quantity | dispatch_date |</span><br><span class="line">+---------+------+----------------+----------+---------+----------+---------------+</span><br><span class="line">|       1 | ka   | 2010-01-01     |        1 |       1 |        2 | 2018-07-26    |</span><br><span class="line">|       1 | ka   | 2010-01-01     |        2 |       1 |        1 | 2018-11-05    |</span><br><span class="line">|       2 | 28   | 2012-05-12     |     NULL |    NULL |     NULL | NULL          |</span><br><span class="line">|       5 | Hu   | 2008-09-21     |     NULL |    NULL |     NULL | NULL          |</span><br><span class="line">+---------+------+----------------+----------+---------+----------+---------------+</span><br></pre></td></tr></table></figure>
<p>然后，统计每本书的销售数量，找出小于10本的，如果数量quantity是null，用IF语句转换为0</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> B.book_id, B.name</span><br><span class="line"><span class="keyword">FROM</span> books <span class="keyword">AS</span> B <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders <span class="keyword">AS</span> O</span><br><span class="line"><span class="keyword">ON</span> O.book_id = B.book_id <span class="keyword">AND</span> O.dispatch_date <span class="keyword">BETWEEN</span> <span class="string">'2018-06-23'</span> <span class="keyword">AND</span> <span class="string">'2019-06-23'</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2019-06-23'</span>, B.available_from) &gt; <span class="number">30</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> B.book_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">SUM</span>(<span class="keyword">IF</span>(O.quantity <span class="keyword">IS</span> <span class="literal">NULL</span>, <span class="number">0</span>, O.quantity)) &lt; <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1107-New-Users-Daily-Count-每日新用户统计"><a href="#1107-New-Users-Daily-Count-每日新用户统计" class="headerlink" title="1107.New Users Daily Count 每日新用户统计"></a>1107.New Users Daily Count 每日新用户统计</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Table: Traffic</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| activity      | enum    |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">The activity column is an ENUM type of (&#39;login&#39;, &#39;logout&#39;, &#39;jobs&#39;, &#39;groups&#39;, &#39;homepage&#39;).</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query that reports for every date within at most 90 days from today, the number of users that logged in for the first time on that date. Assume today is 2019-06-30.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Traffic table:</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line">| user_id | activity | activity_date |</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line">| 1       | login    | 2019-05-01    |</span><br><span class="line">| 1       | homepage | 2019-05-01    |</span><br><span class="line">| 1       | logout   | 2019-05-01    |</span><br><span class="line">| 2       | login    | 2019-06-21    |</span><br><span class="line">| 2       | logout   | 2019-06-21    |</span><br><span class="line">| 3       | login    | 2019-01-01    |</span><br><span class="line">| 3       | jobs     | 2019-01-01    |</span><br><span class="line">| 3       | logout   | 2019-01-01    |</span><br><span class="line">| 4       | login    | 2019-06-21    |</span><br><span class="line">| 4       | groups   | 2019-06-21    |</span><br><span class="line">| 4       | logout   | 2019-06-21    |</span><br><span class="line">| 5       | login    | 2019-03-01    |</span><br><span class="line">| 5       | logout   | 2019-03-01    |</span><br><span class="line">| 5       | login    | 2019-06-21    |</span><br><span class="line">| 5       | logout   | 2019-06-21    |</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+-------------+</span><br><span class="line">| login_date | user_count  |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2019-05-01 | 1           |</span><br><span class="line">| 2019-06-21 | 2           |</span><br><span class="line">+------------+-------------+</span><br><span class="line">Note that we only care about dates with non zero user count.</span><br><span class="line">The user with id 5 first logged in on 2019-03-01 so he&#39;s not counted on 2019-06-21.</span><br></pre></td></tr></table></figure>

<p>解题思路：先找出每个用户最早的登陆日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_id, <span class="keyword">MIN</span>(activity_date) <span class="keyword">AS</span> login_date</span><br><span class="line"><span class="keyword">FROM</span> Traffic</span><br><span class="line"><span class="keyword">WHERE</span> activity = <span class="string">'login'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id;</span><br></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+------------+</span><br><span class="line">| user_id | login_date |</span><br><span class="line">+---------+------------+</span><br><span class="line">|       1 | 2019-05-01 |</span><br><span class="line">|       2 | 2019-06-21 |</span><br><span class="line">|       3 | 2019-01-01 |</span><br><span class="line">|       4 | 2019-06-21 |</span><br><span class="line">|       5 | 2019-03-01 |</span><br><span class="line">+---------+------------+</span><br></pre></td></tr></table></figure>
<p>然后找出最近90天的，并根据登陆时间分组，统计用户数量<br>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> login_date, <span class="keyword">COUNT</span>(user_id) <span class="keyword">AS</span> user_count</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> user_id, <span class="keyword">MIN</span>(activity_date) <span class="keyword">AS</span> login_date</span><br><span class="line">	<span class="keyword">FROM</span> Traffic</span><br><span class="line">	<span class="keyword">WHERE</span> activity = <span class="string">'login'</span></span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id</span><br><span class="line">    )<span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2019-06-30'</span>, login_date) &lt;= <span class="number">90</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> login_date;</span><br></pre></td></tr></table></figure>

<h3 id="1112-Highest-Grade-For-Each-Student-每个同学的最高分"><a href="#1112-Highest-Grade-For-Each-Student-每个同学的最高分" class="headerlink" title="1112 Highest Grade For Each Student 每个同学的最高分"></a>1112 Highest Grade For Each Student 每个同学的最高分</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Table: Enrollments</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| course_id     | int     |</span><br><span class="line">| grade         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(student_id, course_id) is the primary key of this table.</span><br><span class="line"></span><br><span class="line">Write a SQL query to find the highest grade with its corresponding course for each student. In case of a tie, you should find the course with the smallest course_id. The output must be sorted by increasing student_id.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Enrollments table:</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| student_id | course_id | grade |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line">| 2          | 2         | 95    |</span><br><span class="line">| 2          | 3         | 95    |</span><br><span class="line">| 1          | 1         | 90    |</span><br><span class="line">| 1          | 2         | 99    |</span><br><span class="line">| 3          | 1         | 80    |</span><br><span class="line">| 3          | 2         | 75    |</span><br><span class="line">| 3          | 3         | 82    |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| student_id | course_id | grade |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line">| 1          | 2         | 99    |</span><br><span class="line">| 2          | 2         | 95    |</span><br><span class="line">| 3          | 3         | 82    |</span><br><span class="line">+------------+-----------+-------+</span><br></pre></td></tr></table></figure>

<p>解题思路：题目有三个条件，第一个，找出每个学生的最高分成绩。第二个，如果多个课程的最高分相同，那么选出最小的课程id。第三个，按学生id升序排列。</p>
<p>首先找出每个学生的最高分数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, <span class="keyword">MAX</span>(grade)</span><br><span class="line"><span class="keyword">FROM</span> Enrollments</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> student_id;</span><br></pre></td></tr></table></figure>

<p>得到结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------------+------------+</span><br><span class="line">| student_id | MAX(grade) |</span><br><span class="line">+------------+------------+</span><br><span class="line">|          1 |         99 |</span><br><span class="line">|          2 |         95 |</span><br><span class="line">|          3 |         82 |</span><br><span class="line">+------------+------------+</span><br></pre></td></tr></table></figure>
<p>可以看出2号的最高分数是95，但是TA有两门课程都是95，按照题意应选出id=2的课程</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, <span class="keyword">MIN</span>(course_id), grade</span><br><span class="line"><span class="keyword">FROM</span> Enrollments</span><br><span class="line"><span class="keyword">WHERE</span> (student_id, grade) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> student_id, <span class="keyword">MAX</span>(grade)</span><br><span class="line">    <span class="keyword">FROM</span> Enrollments</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> student_id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> student_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> student_id;</span><br></pre></td></tr></table></figure>

<h3 id="1126-Active-Businesses-活跃业务"><a href="#1126-Active-Businesses-活跃业务" class="headerlink" title="1126 Active Businesses 活跃业务"></a>1126 Active Businesses 活跃业务</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Table: Events</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| business_id   | int     |</span><br><span class="line">| event_type    | varchar |</span><br><span class="line">| occurences    | int     | </span><br><span class="line">+---------------+---------+</span><br><span class="line">(business_id, event_type) is the primary key of this table.</span><br><span class="line">Each row in the table logs the info that an event of some type occured at some business for a number of times.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find all active businesses.</span><br><span class="line"></span><br><span class="line">An active business is a business that has more than one event type with occurences greater than the average occurences of that event type among all businesses.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Events table:</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line">| business_id | event_type | occurences |</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line">| 1           | reviews    | 7          |</span><br><span class="line">| 3           | reviews    | 3          |</span><br><span class="line">| 1           | ads        | 11         |</span><br><span class="line">| 2           | ads        | 7          |</span><br><span class="line">| 3           | ads        | 6          |</span><br><span class="line">| 1           | page views | 3          |</span><br><span class="line">| 2           | page views | 12         |</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| business_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+ </span><br><span class="line">Average for &#39;reviews&#39;, &#39;ads&#39; and &#39;page views&#39; are (7+3)&#x2F;2&#x3D;5, (11+7+6)&#x2F;3&#x3D;8, (3+12)&#x2F;2&#x3D;7.5 respectively.</span><br><span class="line">Business with id 1 has 7 &#39;reviews&#39; events (more than 5) and 11 &#39;ads&#39; events (more than 8) so it is an active business.</span><br></pre></td></tr></table></figure>

<p>解题思路：求出每个事件类型的平均发生频率，找出这样的id，它有至少两种事件类型的发生频率是超过该事件类型平均发生频率的。</p>
<p>第一步，求出每个事件类型的平均发生频率</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> event_type, <span class="keyword">AVG</span>(occurences) <span class="keyword">AS</span> event_avg</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Events</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> event_type;</span><br></pre></td></tr></table></figure>
<p>得到的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------------+-----------+</span><br><span class="line">| event_type | event_avg |</span><br><span class="line">+------------+-----------+</span><br><span class="line">| ads        |    8.0000 |</span><br><span class="line">| page views |    7.5000 |</span><br><span class="line">| reviews    |    5.0000 |</span><br><span class="line">+------------+-----------+</span><br></pre></td></tr></table></figure>

<p>第二步，因为需要比较每个事件的发生次数和平均发生次数，因此把平均发生次数的列拼接到原表的右列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> E.*, A.event_avg</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Events</span> <span class="keyword">AS</span> E </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> event_type, <span class="keyword">AVG</span>(occurences) <span class="keyword">AS</span> event_avg</span><br><span class="line">	<span class="keyword">FROM</span> <span class="keyword">Events</span></span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> event_type</span><br><span class="line"></span><br><span class="line">) <span class="keyword">AS</span> A </span><br><span class="line"><span class="keyword">ON</span> E.event_type = A.event_type;</span><br></pre></td></tr></table></figure>
<p>得到结果的如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------------+------------+-----------+</span><br><span class="line">| business_id | event_type | occurences | event_avg |</span><br><span class="line">+-------------+------------+------------+-----------+</span><br><span class="line">|           1 | reviews    |          7 |    5.0000 |</span><br><span class="line">|           3 | reviews    |          3 |    5.0000 |</span><br><span class="line">|           1 | ads        |         11 |    8.0000 |</span><br><span class="line">|           2 | ads        |          7 |    8.0000 |</span><br><span class="line">|           3 | ads        |          6 |    8.0000 |</span><br><span class="line">|           1 | page views |          3 |    7.5000 |</span><br><span class="line">|           2 | page views |         12 |    7.5000 |</span><br><span class="line">+-------------+------------+------------+-----------+</span><br></pre></td></tr></table></figure>
<p>最后，对id分组，过滤出实际发生次数大于平均发生次数的，且事件数量大于1 的</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> T.business_id</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> E.*, A.event_avg</span><br><span class="line">	<span class="keyword">FROM</span> <span class="keyword">Events</span> <span class="keyword">AS</span> E <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> event_type, <span class="keyword">AVG</span>(occurences) <span class="keyword">AS</span> event_avg</span><br><span class="line">		<span class="keyword">FROM</span> <span class="keyword">Events</span></span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> event_type</span><br><span class="line">	) <span class="keyword">AS</span> A <span class="keyword">ON</span> E.event_type = A.event_type</span><br><span class="line">) <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">WHERE</span> T.occurences &gt; T.event_avg</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> T.business_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(T.event_type) &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1132-Reported-Posts-II"><a href="#1132-Reported-Posts-II" class="headerlink" title="1132 Reported Posts II"></a>1132 Reported Posts II</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">Table: Actions</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    |</span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">The action column is an ENUM type of (&#39;view&#39;, &#39;like&#39;, &#39;reaction&#39;, &#39;comment&#39;, &#39;report&#39;, &#39;share&#39;).</span><br><span class="line">The extra column has optional information about the action such as a reason for report or a type of reaction. </span><br><span class="line">Table: Removals</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| remove_date   | date    | </span><br><span class="line">+---------------+---------+</span><br><span class="line">post_id is the primary key of this table.</span><br><span class="line">Each row in this table indicates that some post was removed as a result of being reported or as a result of an admin review.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find the average for daily percentage of posts that got removed after being reported as spam, rounded to 2 decimal places.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Actions table:</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-03  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Removals table:</span><br><span class="line">+---------+-------------+</span><br><span class="line">| post_id | remove_date |</span><br><span class="line">+---------+-------------+</span><br><span class="line">| 2       | 2019-07-20  |</span><br><span class="line">| 3       | 2019-07-18  |</span><br><span class="line">+---------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------------------+</span><br><span class="line">| average_daily_percent |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 75.00                 |</span><br><span class="line">+-----------------------+</span><br><span class="line">The percentage for 2019-07-04 is 50% because only one post of two spam reported posts was removed.</span><br><span class="line">The percentage for 2019-07-02 is 100% because one post was reported as spam and it was removed.</span><br><span class="line">The other days had no spam reports so the average is (50 + 100) &#x2F; 2 &#x3D; 75%</span><br><span class="line">Note that the output is only one number and that we do not care about the remove dates.</span><br></pre></td></tr></table></figure>

<p>解题思路：</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="1149-Article-Views-II"><a href="#1149-Article-Views-II" class="headerlink" title="1149 Article Views II"></a>1149 Article Views II</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Table: Views</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">Each row of this table indicates that some viewer viewed an article (written by some author) on some date. </span><br><span class="line">Note that equal author_id and viewer_id indicate the same person.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find all the people who viewed more than one article on the same date, sorted in ascending order by their id.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Views table:</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 3          | 4         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 5    |</span><br><span class="line">| 6    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>

<p>解题思路：那么先按阅读者-日期分组，找出某读者在该日期阅读的文章数量总和</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> article_id) <span class="keyword">AS</span> articles, viewer_id <span class="keyword">as</span> <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> Views</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> viewer_id, view_date;</span><br></pre></td></tr></table></figure>
<p>得出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------+------+</span><br><span class="line">| articles | id   |</span><br><span class="line">+----------+------+</span><br><span class="line">|        1 |    1 |</span><br><span class="line">|        1 |    4 |</span><br><span class="line">|        2 |    5 |</span><br><span class="line">|        2 |    6 |</span><br><span class="line">|        1 |    7 |</span><br><span class="line">+----------+------+</span><br></pre></td></tr></table></figure>
<p>然后找出文章总数量超过1的读者id</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> t.id</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> article_id) <span class="keyword">AS</span> articles, viewer_id <span class="keyword">as</span> <span class="keyword">id</span></span><br><span class="line">	<span class="keyword">FROM</span> Views</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> viewer_id, view_date</span><br><span class="line">) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">WHERE</span> t.articles &gt; <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> t.id;</span><br></pre></td></tr></table></figure>

<h3 id="1158-Market-Analysis-I"><a href="#1158-Market-Analysis-I" class="headerlink" title="1158 Market Analysis I"></a>1158 Market Analysis I</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">Table: Users</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| join_date      | date    |</span><br><span class="line">| favorite_brand | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">user_id is the primary key of this table.</span><br><span class="line">This table has the info of the users of an online shopping website where users can sell and buy items.</span><br><span class="line">Table: Orders</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| buyer_id      | int     |</span><br><span class="line">| seller_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id is the primary key of this table.</span><br><span class="line">item_id is a foreign key to the Items table.</span><br><span class="line">buyer_id and seller_id are foreign keys to the Users table.</span><br><span class="line">Table: Items</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| item_brand    | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">item_id is the primary key of this table.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find for each user, the join date and the number of orders they made as a buyer in 2019.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Users table:</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| user_id | join_date  | favorite_brand |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| 1       | 2018-01-01 | Lenovo         |</span><br><span class="line">| 2       | 2018-02-09 | Samsung        |</span><br><span class="line">| 3       | 2018-01-19 | LG             |</span><br><span class="line">| 4       | 2018-05-21 | HP             |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| order_id | order_date | item_id | buyer_id | seller_id |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| 1        | 2019-08-01 | 4       | 1        | 2         |</span><br><span class="line">| 2        | 2018-08-02 | 2       | 1        | 3         |</span><br><span class="line">| 3        | 2019-08-03 | 3       | 2        | 3         |</span><br><span class="line">| 4        | 2018-08-04 | 1       | 4        | 2         |</span><br><span class="line">| 5        | 2018-08-04 | 1       | 3        | 4         |</span><br><span class="line">| 6        | 2019-08-05 | 2       | 2        | 4         |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line"></span><br><span class="line">Items table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| item_id | item_brand |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Samsung    |</span><br><span class="line">| 2       | Lenovo     |</span><br><span class="line">| 3       | LG         |</span><br><span class="line">| 4       | HP         |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+------------+----------------+</span><br><span class="line">| buyer_id  | join_date  | orders_in_2019 |</span><br><span class="line">+-----------+------------+----------------+</span><br><span class="line">| 1         | 2018-01-01 | 1              |</span><br><span class="line">| 2         | 2018-02-09 | 2              |</span><br><span class="line">| 3         | 2018-01-19 | 0              |</span><br><span class="line">| 4         | 2018-05-21 | 0              |</span><br><span class="line">+-----------+------------+----------------+</span><br></pre></td></tr></table></figure>

<p>解题思路：每个用户的id，加入时间，在2019年的订单数量。首先找出每个用户每一笔的订单情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> O.buyer_id, O.order_date, U.join_date</span><br><span class="line"><span class="keyword">FROM</span> Orders2 <span class="keyword">AS</span> O <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">Users</span> <span class="keyword">AS</span> U</span><br><span class="line"><span class="keyword">ON</span> O.buyer_id = U.user_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> O.buyer_id, O.order_date;</span><br></pre></td></tr></table></figure>
<p>得到的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------+------------+------------+</span><br><span class="line">| buyer_id | order_date | join_date  |</span><br><span class="line">+----------+------------+------------+</span><br><span class="line">|        1 | 2018-08-02 | 2018-01-01 |</span><br><span class="line">|        1 | 2019-08-01 | 2018-01-01 |</span><br><span class="line">|        2 | 2019-08-03 | 2018-02-09 |</span><br><span class="line">|        2 | 2019-08-05 | 2018-02-09 |</span><br><span class="line">|        3 | 2018-08-04 | 2018-01-19 |</span><br><span class="line">|        4 | 2018-08-04 | 2018-05-21 |</span><br><span class="line">+----------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>以这个表为基础，按购买者id分类，统计其在2019年的订单总量，</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t.buyer_id, t.join_date, <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">YEAR</span>(t.order_date)=<span class="number">2019</span>, <span class="number">1</span>,<span class="number">0</span>)) <span class="keyword">AS</span> orders_id_2019</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> O.buyer_id, O.order_date, U.join_date</span><br><span class="line">	<span class="keyword">FROM</span> Orders2 <span class="keyword">AS</span> O <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">Users</span> <span class="keyword">AS</span> U</span><br><span class="line">	<span class="keyword">ON</span> O.buyer_id = U.user_id</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> O.buyer_id, O.order_date</span><br><span class="line">) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> t.buyer_id;</span><br></pre></td></tr></table></figure>

<h3 id="1164-Product-Price-at-a-Given-Date"><a href="#1164-Product-Price-at-a-Given-Date" class="headerlink" title="1164 Product Price at a Given Date"></a>1164 Product Price at a Given Date</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Table: Products</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| new_price     | int     |</span><br><span class="line">| change_date   | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_id, change_date) is the primary key of this table.</span><br><span class="line">Each row of this table indicates that the price of some product was changed to a new price at some date.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find the prices of all products on 2019-08-16. Assume the price of all products before any change is 10.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Products table:</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| product_id | new_price | change_date |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| 1          | 20        | 2019-08-14  |</span><br><span class="line">| 2          | 50        | 2019-08-14  |</span><br><span class="line">| 1          | 30        | 2019-08-15  |</span><br><span class="line">| 1          | 35        | 2019-08-16  |</span><br><span class="line">| 2          | 65        | 2019-08-17  |</span><br><span class="line">| 3          | 20        | 2019-08-18  |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+-------+</span><br><span class="line">| product_id | price |</span><br><span class="line">+------------+-------+</span><br><span class="line">| 2          | 50    |</span><br><span class="line">| 1          | 35    |</span><br><span class="line">| 3          | 10    |</span><br><span class="line">+------------+-------+</span><br></pre></td></tr></table></figure>

<p>解题思路：</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1174-Immediate-Food-Delivery-II"><a href="#1174-Immediate-Food-Delivery-II" class="headerlink" title="1174 Immediate Food Delivery II"></a>1174 Immediate Food Delivery II</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Table: Delivery</span><br><span class="line"></span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id is the primary key of this table.</span><br><span class="line">The table holds information about food delivery to customers that make orders at some date and specify a preferred delivery date (on the same order date or after it).</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">If the preferred delivery date of the customer is the same as the order date then the order is called immediate otherwise it&#39;s called scheduled.</span><br><span class="line"></span><br><span class="line">The first order of a customer is the order with the earliest order date that customer made. It is guaranteed that a customer has exactly one first order.</span><br><span class="line"></span><br><span class="line">Write an SQL query to find the percentage of immediate orders in the first orders of all customers, rounded to 2 decimal places.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Delivery table:</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 2           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-12                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-24                  |</span><br><span class="line">| 5           | 3           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">| 7           | 4           | 2019-08-09 | 2019-08-09                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 50.00                |</span><br><span class="line">+----------------------+</span><br><span class="line">The customer id 1 has a first order with delivery id 1 and it is scheduled.</span><br><span class="line">The customer id 2 has a first order with delivery id 2 and it is immediate.</span><br><span class="line">The customer id 3 has a first order with delivery id 5 and it is scheduled.</span><br><span class="line">The customer id 4 has a first order with delivery id 7 and it is immediate.</span><br><span class="line">Hence, half the customers have immediate first orders.</span><br></pre></td></tr></table></figure>

<p>解题思路：</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1193-Monthly-Transactions-I"><a href="#1193-Monthly-Transactions-I" class="headerlink" title="1193 Monthly Transactions I"></a>1193 Monthly Transactions I</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Table: Transactions</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| country       | varchar |</span><br><span class="line">| state         | enum    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">| trans_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id is the primary key of this table.</span><br><span class="line">The table has information about incoming transactions.</span><br><span class="line">The state column is an enum of type [&quot;approved&quot;, &quot;declined&quot;].</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find for each month and country, the number of transactions and their total amount, the number of approved transactions and their total amount.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Transactions table:</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 121  | US      | approved | 1000   | 2018-12-18 |</span><br><span class="line">| 122  | US      | declined | 2000   | 2018-12-19 |</span><br><span class="line">| 123  | US      | approved | 2000   | 2019-01-01 |</span><br><span class="line">| 124  | DE      | approved | 2000   | 2019-01-07 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |</span><br><span class="line">| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br></pre></td></tr></table></figure>

<p>解题思路：根据月份和国家分组，然后统计每组内的题目要求的数据即可。</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="keyword">LEFT</span>(trans_date, <span class="number">7</span>) <span class="keyword">AS</span> <span class="string">'month'</span>, </span><br><span class="line">    country, </span><br><span class="line">    <span class="keyword">COUNT</span>(<span class="keyword">id</span>) <span class="keyword">AS</span> <span class="string">'trans_count'</span>, </span><br><span class="line">    <span class="keyword">SUM</span>(<span class="keyword">IF</span>(state=<span class="string">'approved'</span>, <span class="number">1</span>,<span class="number">0</span>)) <span class="keyword">AS</span> <span class="string">'approved_count'</span>, </span><br><span class="line">    <span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> <span class="string">'trans_total_amount'</span>, </span><br><span class="line">    <span class="keyword">IF</span>(state=<span class="string">'approved'</span>, amount, <span class="number">0</span>) <span class="keyword">AS</span> <span class="string">'approved_total_amount'</span></span><br><span class="line"><span class="keyword">FROM</span> Transactions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">MONTH</span>(trans_date), country</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> trans_count <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1204-Last-Person-to-Fit-in-the-Elevator"><a href="#1204-Last-Person-to-Fit-in-the-Elevator" class="headerlink" title="1204. Last Person to Fit in the Elevator"></a>1204. Last Person to Fit in the Elevator</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Table: Queue</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| person_id   | int     |</span><br><span class="line">| person_name | varchar |</span><br><span class="line">| weight      | int     |</span><br><span class="line">| turn        | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">person_id is the primary key column for this table.</span><br><span class="line">This table has the information about all people waiting for an elevator.</span><br><span class="line">The person_id and turn columns will contain all numbers from 1 to n, where n is the number of rows in the table.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">The maximum weight the elevator can hold is 1000.</span><br><span class="line"></span><br><span class="line">Write an SQL query to find the person_name of the last person who will fit in the elevator without exceeding the weight limit. It is guaranteed that the person who is first in the queue can fit in the elevator.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Queue table</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| person_id | person_name       | weight | turn |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| 5         | George Washington | 250    | 1    |</span><br><span class="line">| 3         | John Adams        | 350    | 2    |</span><br><span class="line">| 6         | Thomas Jefferson  | 400    | 3    |</span><br><span class="line">| 2         | Will Johnliams    | 200    | 4    |</span><br><span class="line">| 4         | Thomas Jefferson  | 175    | 5    |</span><br><span class="line">| 1         | James Elephant    | 500    | 6    |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line"></span><br><span class="line">Result table</span><br><span class="line">+-------------------+</span><br><span class="line">| person_name       |</span><br><span class="line">+-------------------+</span><br><span class="line">| Thomas Jefferson  |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">Queue table is ordered by turn in the example for simplicity.</span><br><span class="line">In the example George Washington(id 5), John Adams(id 3) and Thomas Jefferson(id 6) will enter the elevator as their weight sum is 250 + 350 + 400 &#x3D; 1000.</span><br><span class="line">Thomas Jefferson(id 6) is the last person to fit in the elevator because he has the last turn in these three people.</span><br></pre></td></tr></table></figure>

<p>解题思路：按照进电梯的顺序对每个人的体重累加，求出累加和为1000时的人的名字。先对weight进行累加：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *, (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">SUM</span>(weight)</span><br><span class="line">    <span class="keyword">FROM</span> Queue</span><br><span class="line">    <span class="keyword">WHERE</span> turn &lt;= Q.turn</span><br><span class="line">) <span class="keyword">AS</span> leijia</span><br><span class="line"><span class="keyword">FROM</span> Queue <span class="keyword">AS</span> Q</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> turn;</span><br></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----------+-------------------+--------+------+--------+</span><br><span class="line">| person_id | person_name       | weight | turn | leijia |</span><br><span class="line">+-----------+-------------------+--------+------+--------+</span><br><span class="line">|         5 | George Washington |    250 |    1 |    250 |</span><br><span class="line">|         3 | John Adams        |    350 |    2 |    600 |</span><br><span class="line">|         6 | Thomas Jefferson  |    400 |    3 |   1000 |</span><br><span class="line">|         2 | Will Johnliams    |    200 |    4 |   1200 |</span><br><span class="line">|         4 | Thomas Jefferson  |    175 |    5 |   1375 |</span><br><span class="line">|         1 | James Elephant    |    500 |    6 |   1875 |</span><br><span class="line">+-----------+-------------------+--------+------+--------+</span><br></pre></td></tr></table></figure>
<p>再以这张表为基础，找出leijia列值为1000的人的名字<br>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> person_name </span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> *, (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="keyword">SUM</span>(weight)</span><br><span class="line">            <span class="keyword">FROM</span> Queue</span><br><span class="line">            <span class="keyword">WHERE</span> turn &lt;= Q.turn</span><br><span class="line">        ) <span class="keyword">AS</span> leijia</span><br><span class="line">    <span class="keyword">FROM</span> Queue <span class="keyword">AS</span> Q</span><br><span class="line">) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">WHERE</span> t.leijia = <span class="number">1000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> turn;</span><br></pre></td></tr></table></figure>

<h3 id="1205-Monthly-Transactions-II"><a href="#1205-Monthly-Transactions-II" class="headerlink" title="1205 Monthly Transactions II"></a>1205 Monthly Transactions II</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">Table: Transactions</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| id             | int     |</span><br><span class="line">| country        | varchar |</span><br><span class="line">| state          | enum    |</span><br><span class="line">| amount         | int     |</span><br><span class="line">| trans_date     | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">id is the primary key of this table.</span><br><span class="line">The table has information about incoming transactions.</span><br><span class="line">The state column is an enum of type [&quot;approved&quot;, &quot;declined&quot;].</span><br><span class="line">Table: Chargebacks</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| trans_id       | int     |</span><br><span class="line">| charge_date    | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">Chargebacks contains basic information regarding incoming chargebacks from some transactions placed in Transactions table.</span><br><span class="line">trans_id is a foreign key to the id column of Transactions table.</span><br><span class="line">Each chargeback corresponds to a transaction made previously even if they were not approved.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Write an SQL query to find for each month and country, the number of approved transactions and their total amount, the number of chargebacks and their total amount.</span><br><span class="line"></span><br><span class="line">Note: In your query, given the month and country, ignore rows with all zeros.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Transactions table:</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 101  | US      | approved | 1000   | 2019-05-18 |</span><br><span class="line">| 102  | US      | declined | 2000   | 2019-05-19 |</span><br><span class="line">| 103  | US      | approved | 3000   | 2019-06-10 |</span><br><span class="line">| 104  | US      | approved | 4000   | 2019-06-13 |</span><br><span class="line">| 105  | US      | approved | 5000   | 2019-06-15 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line"></span><br><span class="line">Chargebacks table:</span><br><span class="line">+------------+------------+</span><br><span class="line">| trans_id   | trans_date |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 102        | 2019-05-29 |</span><br><span class="line">| 101        | 2019-06-30 |</span><br><span class="line">| 105        | 2019-09-18 |</span><br><span class="line">+------------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br><span class="line">| month    | country | approved_count | approved_amount | chargeback_count  | chargeback_amount  |</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br><span class="line">| 2019-05  | US      | 1              | 1000            | 1                 | 2000               |</span><br><span class="line">| 2019-06  | US      | 3              | 12000           | 1                 | 1000               |</span><br><span class="line">| 2019-09  | US      | 0              | 0               | 1                 | 5000               |</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br></pre></td></tr></table></figure>

<p>解题思路：</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1212-Team-Scores-in-Football-Tournament"><a href="#1212-Team-Scores-in-Football-Tournament" class="headerlink" title="1212 Team Scores in Football Tournament"></a>1212 Team Scores in Football Tournament</h3><p>题目描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">Table: Teams</span><br><span class="line"></span><br><span class="line">+---------------+----------+</span><br><span class="line">| Column Name   | Type     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| team_id       | int      |</span><br><span class="line">| team_name     | varchar  |</span><br><span class="line">+---------------+----------+</span><br><span class="line">team_id is the primary key of this table.</span><br><span class="line">Each row of this table represents a single football team.</span><br><span class="line"></span><br><span class="line">Table: Matches</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| host_team     | int     |</span><br><span class="line">| guest_team    | int     | </span><br><span class="line">| host_goals    | int     |</span><br><span class="line">| guest_goals   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">match_id is the primary key of this table.</span><br><span class="line">Each row is a record of a finished match between two different teams. </span><br><span class="line">Teams host_team and guest_team are represented by their IDs in the teams table (team_id) and they scored host_goals and guest_goals goals respectively.</span><br><span class="line"> </span><br><span class="line">You would like to compute the scores of all teams after all matches. Points are awarded as follows:</span><br><span class="line">A team receives three points if they win a match (Score strictly more goals than the opponent team).</span><br><span class="line">A team receives one point if they draw a match (Same number of goals as the opponent team).</span><br><span class="line">A team receives no points if they lose a match (Score less goals than the opponent team).</span><br><span class="line"></span><br><span class="line">Write an SQL query that selects the team_id, team_name and num_points of each team in the tournament after all described matches. Result table should be ordered by num_points (decreasing order). In case of a tie, order the records by team_id (increasing order).</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Teams table:</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| team_id   | team_name    |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| 10        | Leetcode FC  |</span><br><span class="line">| 20        | NewYork FC   |</span><br><span class="line">| 30        | Atlanta FC   |</span><br><span class="line">| 40        | Chicago FC   |</span><br><span class="line">| 50        | Toronto FC   |</span><br><span class="line">+-----------+--------------+</span><br><span class="line"></span><br><span class="line">Matches table:</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| match_id   | host_team    | guest_team    | host_goals  | guest_goals  |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| 1          | 10           | 20            | 3           | 0            |</span><br><span class="line">| 2          | 30           | 10            | 2           | 2            |</span><br><span class="line">| 3          | 10           | 50            | 5           | 1            |</span><br><span class="line">| 4          | 20           | 30            | 1           | 0            |</span><br><span class="line">| 5          | 50           | 30            | 1           | 0            |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| team_id    | team_name    | num_points    |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| 10         | Leetcode FC  | 7             |</span><br><span class="line">| 20         | NewYork FC   | 3             |</span><br><span class="line">| 50         | Toronto FC   | 3             |</span><br><span class="line">| 30         | Atlanta FC   | 1             |</span><br><span class="line">| 40         | Chicago FC   | 0             |</span><br><span class="line">+------------+--------------+---------------+</span><br></pre></td></tr></table></figure>

<p>解题思路：</p>
<p>通过代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://huanyouchen.github.io/2019/10/26/SQL-exercises-LeetCode-medium-part/';
    this.page.identifier = '2019/10/26/SQL-exercises-LeetCode-medium-part/';
    this.page.title = 'LeetCode中的sql练习题-medium难度部分';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//huanyouchen-blog.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//huanyouchen-blog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://huanyouchen-blog.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">幻悠尘的小窝.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>